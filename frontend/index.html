<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Interview Practice Partner ‚Äî Neon</title>

  <!-- Neon / Cyber theme (black + neon blue) -->
  <style>
   :root{
  --bg-1:#07070a;        /* deep black */
  --bg-2:#0f1720;        /* slightly lighter */
  --panel:#0b1220;       /* panel dark */
  --neon:#00d4ff;        /* neon cyan/blue */
  --neon-2:#00a8ff;      /* slightly darker neon */
  --muted:#97a6b2;       /* muted grey */
  --accent-glow: 0 6px 40px rgba(0,212,255,0.08), inset 0 1px 0 rgba(255,255,255,0.02);
  --glass: rgba(255,255,255,0.03);
  --radius:12px;
  --shadow-lg: 0 12px 40px rgba(2,6,23,0.6);
  font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
}

*{box-sizing:border-box}
html,body{height:100%;margin:0;background:linear-gradient(160deg,var(--bg-1) 0%,var(--bg-2) 100%);color:#e6f7ff}
.wrap{
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:36px;
  gap:24px;
}
/* Neon alert overlay */
.neon-alert-overlay {
    position: fixed;
    top:0; left:0; width:100%; height:100%;
    background: rgba(0,0,0,0.85);
    display:flex;
    justify-content:center;
    align-items:center;
    z-index:1000;
}

.neon-alert {
    background: rgba(0,0,0,0.95);
    border:1px solid #00d4ff;
    border-radius:16px;
    padding:24px;
    max-width: 360px;
    text-align:center;
    color:#fff;
}
.neon-alert-icon {
    font-size: 48px; /* make it bigger */
    color: #00d4ff;  /* neon color */
    margin-bottom: 10px;
}

.neon-alert button {
    background: linear-gradient(90deg,#00d4ff,#00a8ff);
    border:none;
    color:#04202a;
    padding:10px 18px;
    border-radius:12px;
    cursor:pointer;
    font-weight:700;
    margin-top:16px;
}

/* Card */
.card{
  width:980px;
  max-width:96%;
  background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.015));
  border-radius:16px;
  padding:22px;
  box-shadow:var(--shadow-lg);
  display:grid;
  grid-template-columns: 360px 1fr;
  gap:18px;
  overflow:hidden;
}

/* LEFT: controls / role / instructions */
.left{
  padding:18px;
  border-radius:12px;
  background:linear-gradient(180deg, rgba(0,0,0,0.22), rgba(255,255,255,0.02));
  border:1px solid rgba(0,168,255,0.08);
  display:flex;
  flex-direction:column;
  gap:12px;
  align-items:stretch;
}

.brand{
  display:flex;
  gap:12px;
  align-items:center;
}
.logo{
  width:56px;height:56px;border-radius:10px;
  background:linear-gradient(135deg,var(--neon),var(--neon-2));
  box-shadow:0 6px 30px rgba(0,168,255,0.16);
  display:flex;align-items:center;justify-content:center;font-weight:700;color:#041b23;font-size:20px;
}
.brand h2{margin:0;font-size:16px}
.brand p{margin:0;font-size:12px;color:var(--muted)}

label{font-size:13px;color:var(--muted);margin-top:6px}
input[type="text"]{
  padding:12px 14px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);
  background:var(--glass);color:#eafcff;outline:none;font-size:14px;
  transition: box-shadow .18s, border-color .18s;
}
input[type="text"]:focus{
  box-shadow: 0 6px 30px rgba(0,212,255,0.06);
  border-color: rgba(0,212,255,0.28);
}

.start-btn{
  margin-top:8px;padding:12px;border-radius:10px;background:linear-gradient(90deg,var(--neon),var(--neon-2));
  color:#04202a;border:none;font-weight:700;cursor:pointer;font-size:14px;
  box-shadow:var(--accent-glow);
}
.note{font-size:12px;color:var(--muted);line-height:1.35}

/* Role Suggestions */
.suggestions {
    margin-top: 8px;
}

.suggestion-title {
    font-size: 12px;
    color: var(--muted);
    margin-bottom: 8px;
}

.suggestion-chips {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
}

.suggestion-chip {
    background: rgba(0, 212, 255, 0.1);
    border: 1px solid rgba(0, 212, 255, 0.2);
    border-radius: 16px;
    padding: 4px 10px;
    font-size: 11px;
    color: var(--neon);
    cursor: pointer;
    transition: all 0.3s ease;
}

.suggestion-chip:hover {
    background: rgba(0, 212, 255, 0.2);
    transform: translateY(-1px);
}

/* Right: chat column */
.right{
  padding:18px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.015));
  border:1px solid rgba(255,255,255,0.02);display:flex;flex-direction:column;height:560px;
}

.chat-header{
  display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;
}
.chat-header h3{margin:0;font-size:16px}
.status{
  font-size:13px;color:var(--muted);display:flex;gap:8px;align-items:center;
}
.dot{
  width:10px;height:10px;border-radius:50%;
  background:linear-gradient(180deg,var(--neon),var(--neon-2));
  box-shadow:0 6px 18px rgba(0,212,255,0.12);
}

/* chat area */
#chat{
  flex:1;padding:14px;border-radius:10px;background:linear-gradient(180deg, rgba(2,6,23,0.5), rgba(2,6,23,0.3));
  overflow:auto; display:flex;flex-direction:column;gap:12px;
}

.msg{
  max-width:78%;padding:12px 14px;border-radius:12px;word-wrap:break-word;line-height:1.35;animation:slideUp 220ms ease;
}
@keyframes slideUp{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
.msg.agent{
  background:linear-gradient(180deg, rgba(4,20,28,0.5), rgba(4,20,28,0.3));
  border:1px solid rgba(0,168,255,0.06);
  color:#dff9ff;
  align-self:flex-start;
  box-shadow: 0 6px 24px rgba(0,0,0,0.45);
}
.msg.you{
  background:linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
  color:#a9eeff;
  align-self:flex-end;
  border:1px solid rgba(255,255,255,0.04);
  box-shadow: 0 10px 30px rgba(0,0,0,0.45);
}

.meta{font-size:12px;color:var(--muted);margin-bottom:6px}
.assistant-name{display:flex;gap:8px;align-items:center;font-weight:700;color:var(--neon)}
.time{font-size:11px;color:var(--muted)}

/* input row */
.controls{
  margin-top:14px;display:flex;gap:10px;align-items:center;
}

.text-input{
  flex:1;display:flex;gap:8px;align-items:center;
}
.text-input input{
  width:100%;
  padding:12px 14px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);
  background:transparent;color:#eaffff;font-size:14px;
}

.btn{
  padding:10px 14px;border-radius:10px;border:none;font-weight:700;cursor:pointer;
}

.send-btn{
  background:linear-gradient(90deg,var(--neon-2),var(--neon));
  color:#051a21;
  box-shadow: 0 8px 30px rgba(0,168,255,0.14);
}

.mic-btn{
  background:transparent;border:1px solid rgba(0,168,255,0.14);color:var(--neon);width:56px;height:44px;border-radius:10px;display:flex;align-items:center;justify-content:center;
}

.mic-btn.listening{
  background:linear-gradient(90deg,var(--neon),var(--neon-2));color:#041a21;box-shadow:0 12px 48px rgba(0,168,255,0.12);
  animation:micPulse 1.1s infinite;
}
@keyframes micPulse{
  0%{transform:translateY(0) scale(1)}
  50%{transform:translateY(-2px) scale(1.02)}
  100%{transform:translateY(0) scale(1)}
}

.typing{
  display:flex;gap:6px;align-items:center;padding:8px 10px;border-radius:10px;background:rgba(255,255,255,0.02);width:max-content;
}
.dot-anim{width:8px;height:8px;border-radius:50%;background:var(--neon);opacity:0.9;animation:bounce 1s infinite}
.dot-anim.two{animation-delay:0.12s}
.dot-anim.three{animation-delay:0.24s}
@keyframes bounce{0%{transform:translateY(0);opacity:0.4}50%{transform:translateY(-6px);opacity:1}100%{transform:translateY(0);opacity:0.4}}

/* Custom Neon Alert Styles */
.neon-alert-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(7, 7, 10, 0.85);
    backdrop-filter: blur(8px);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    animation: fadeIn 0.3s ease;
}

.neon-alert {
    background: linear-gradient(180deg, rgba(11, 18, 32, 0.95), rgba(15, 23, 32, 0.95));
    border: 1px solid rgba(0, 212, 255, 0.2);
    border-radius: 16px;
    padding: 28px;
    width: 380px;
    max-width: 90%;
    box-shadow: 
        0 20px 60px rgba(2, 6, 23, 0.8),
        0 0 0 1px rgba(0, 212, 255, 0.1),
        inset 0 1px 0 rgba(255, 255, 255, 0.05);
    animation: slideUpAlert 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    position: relative;
    overflow: hidden;
}

.neon-alert::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg, var(--neon), var(--neon-2));
    animation: pulseGlow 2s infinite;
}

.neon-alert-icon {
    width: 60px;
    height: 60px;
    margin: 0 auto 20px;
    background: linear-gradient(135deg, rgba(0, 212, 255, 0.1), rgba(0, 168, 255, 0.05));
    border: 1px solid rgba(0, 212, 255, 0.2);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    color: var(--neon);
    box-shadow: 0 8px 32px rgba(0, 212, 255, 0.15);
}

.neon-alert h3 {
    margin: 0 0 12px 0;
    font-size: 18px;
    font-weight: 700;
    text-align: center;
    background: linear-gradient(90deg, var(--neon), var(--neon-2));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.neon-alert p {
    margin: 0 0 24px 0;
    text-align: center;
    color: var(--muted);
    font-size: 14px;
    line-height: 1.5;
}

.neon-alert-buttons {
    display: flex;
    gap: 12px;
    justify-content: center;
}

.neon-alert-btn {
    padding: 12px 24px;
    border: none;
    border-radius: 10px;
    font-weight: 700;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.3s ease;
    min-width: 100px;
}

.neon-alert-btn.confirm {
    background: linear-gradient(90deg, var(--neon), var(--neon-2));
    color: #04202a;
    box-shadow: var(--accent-glow);
}

.neon-alert-btn.confirm:hover {
    transform: translateY(-2px);
    box-shadow: 0 12px 40px rgba(0, 212, 255, 0.25);
}

.neon-alert-btn.confirm:active {
    transform: translateY(0);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes slideUpAlert {
    from { 
        opacity: 0;
        transform: translateY(30px) scale(0.95);
    }
    to { 
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

@keyframes pulseGlow {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
}

/* small screens */
@media (max-width:880px){
  .card{grid-template-columns:1fr; width:95%}
  .left{order:2}
  .right{order:1;height:640px}
}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="application" aria-label="Interview Practice Partner">
      <!-- LEFT -->
      <div class="left" aria-hidden="false">
        <div class="brand">
          <div class="logo">AI</div>
          <div>
            <h2>Interview Practice</h2>
            <p style="margin-top:4px;color:var(--muted)">Practice answers with a voice-enabled AI interviewer</p>
          </div>
        </div>

        <label for="role">Role</label>
        <input id="role" type="text" placeholder="e.g. Senior Python Developer">

        <!-- Role Suggestions -->
        <div class="suggestions">
          <div class="suggestion-title">Try these roles:</div>
          <div class="suggestion-chips" id="suggestionChips">
            <!-- Chips will be added by JavaScript -->
          </div>
        </div>

        <button id="startBtn" class="start-btn" title="Start interview session">Start Interview</button>
<!-- STOP INTERVIEW BUTTON -->
<button id="stopBtn" style="background: linear-gradient(90deg,#ff0055,#ff3366); color:#fff; padding:12px 20px; border:none; border-radius:12px; cursor:pointer; margin-top:12px;">
  Stop Interview
</button>

        <div class="note" style="margin-top:6px">
          Tip: Use the mic button to speak. 
        </div>

        <div style="margin-top:auto;font-size:12px;color:var(--muted)">
          <div style="display:flex;justify-content:space-between;align-items:center">
           
          </div>
          <div style="margin-top:10px;font-size:12px">Status: <span class="status-text" style="color:var(--muted)">Idle</span></div>
        </div>
      </div>

      <!-- RIGHT: Chat -->
      <div class="right" role="region" aria-live="polite">
        <div class="chat-header">
          <div>
            <h3>Interviewer</h3>
            <div class="status"><div class="dot" aria-hidden="true"></div><span style="color:var(--muted);margin-left:6px">Online</span></div>
          </div>
          <div class="time" id="localTime"></div>
        </div>

        <div id="chat" aria-atomic="false" aria-relevant="additions"></div>

        <div class="controls" style="margin-top:12px">
          <div class="text-input">
            <input id="userInput" type="text" placeholder="Type your answer...">
          </div>

          <button id="sendBtn" class="btn send-btn" aria-label="Send message">Send</button>
          <button id="micBtn" class="mic-btn" aria-label="Toggle microphone">üé§</button>
        </div>
      </div>

    </div>
  </div>

  <script>
// =========================================================
// Elements
// =========================================================
const roleInput = document.getElementById("role");
const startBtn = document.getElementById("startBtn");
const chatDiv = document.getElementById("chat");
const userInput = document.getElementById("userInput");
const sendBtn = document.getElementById("sendBtn");
const micBtn = document.getElementById("micBtn");
const statusText = document.querySelector('.status-text');
const localTime = document.getElementById('localTime');

// =========================================================
// Global variables
// =========================================================
let sessionId = null;
let isListening = false;

// =========================================================
// Update local time display
// =========================================================
function updateTime() { 
    localTime.textContent = new Date().toLocaleString(); 
}
setInterval(updateTime, 60 * 1000);
updateTime();

// =========================================================
// Stop all TTS
// =========================================================
function stopTTS() {
    speechSynthesis.cancel();
}

// =========================================================
// Speech Recognition Setup
// =========================================================
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
let recognition = null;

if (SpeechRecognition) {
    recognition = new SpeechRecognition();
    recognition.lang = "en-US";
    recognition.interimResults = false;
    recognition.continuous = false;   // CHANGED: Set to false to prevent auto-send

    recognition.onstart = () => {
        isListening = true;
        micBtn.classList.add("listening");
        micBtn.textContent = '‚óè';
    };

    recognition.onend = () => {
        isListening = false;
        micBtn.classList.remove("listening");
        micBtn.textContent = 'üé§';
    };

    recognition.onerror = (e) => {
        console.error("Speech Error:", e);
        appendSystem('Speech recognition error: ' + (e.error || 'unknown'));
    };

    recognition.onresult = (event) => {
        let transcript = "";

        for (let i = 0; i < event.results.length; i++) {
            transcript += event.results[i][0].transcript + " ";
        }

        userInput.value = transcript.trim();  // Only put text into input
        // NO AUTO SEND - user must click send button
    };
} else {
    alert("Speech Recognition not supported in this browser.");
    micBtn.disabled = true;
    appendSystem('Speech Recognition not supported in this browser.');
}

// =========================================================
// Custom Neon Alert
// =========================================================
function showNeonAlert(message, title = "Attention") {
    return new Promise((resolve) => {
        // Create overlay
        const overlay = document.createElement('div');
        overlay.className = 'neon-alert-overlay';
        
        // Create alert
        const alert = document.createElement('div');
        alert.className = 'neon-alert';
        alert.innerHTML = `
            <div class="neon-alert-icon">‚ö†Ô∏è</div>
            <h3>${title}</h3>
            <p>${message}</p>
            <div class="neon-alert-buttons">
                <button class="neon-alert-btn confirm">Got it</button>
            </div>
        `;
        
        overlay.appendChild(alert);
        document.body.appendChild(overlay);
        
        // Focus the button for accessibility
        const confirmBtn = alert.querySelector('.confirm');
        confirmBtn.focus();
        
        // Handle confirm button click
        confirmBtn.addEventListener('click', () => {
            document.body.removeChild(overlay);
            resolve(true);
        });
        
        // Handle overlay click (close when clicking outside)
        overlay.addEventListener('click', (e) => {
            if (e.target === overlay) {
                document.body.removeChild(overlay);
                resolve(true);
            }
        });
        
        // Handle Escape key
        const handleKeydown = (e) => {
            if (e.key === 'Escape') {
                document.body.removeChild(overlay);
                document.removeEventListener('keydown', handleKeydown);
                resolve(true);
            }
        };
        
        document.addEventListener('keydown', handleKeydown);
    });
}

// =========================================================
// Role Validation
// =========================================================
function isValidRole(role) {
    if (!role || role.trim().length < 2) return false;
    
    const roleLower = role.toLowerCase().trim();
    
    // Common invalid inputs (names, greetings, etc.)
    const invalidPatterns = [
        // Common names and greetings
        /\b(hi|hello|hey|my name is|i am|this is)\b/i,
        /\b(mr|ms|mrs|dr|prof)\b\.?\s+\w+/i,
        // Single words that are likely names
        /\b(john|jane|smith|doe|alex|mike|david|sarah|emma|lucas)\b/i,
        // Too short or generic
        /^\w+$/i // Single word only
    ];
    
    // Check for invalid patterns
    for (const pattern of invalidPatterns) {
        if (pattern.test(roleLower)) {
            return false;
        }
    }
    
    // Check if it looks like a job role (positive patterns)
    const jobRoleIndicators = [
        // Job titles with common prefixes/suffixes
        /\b(senior|junior|lead|principal|staff|associate|assistant)\b/i,
        /\b(engineer|developer|analyst|manager|specialist|consultant|architect)\b/i,
        /\b(director|head|chief|officer|president|vice president)\b/i,
        /\b(designer|researcher|scientist|advisor|coordinator)\b/i,
        // Common role patterns
        /\w+\s+\w+/i, // At least two words
        /.+[eE]ngineer$/i,
        /.+[dD]eveloper$/i,
        /.+[mM]anager$/i,
        /.+[aA]nalyst$/i,
        /.+[dD]esigner$/i
    ];
    
    // If it matches at least one job role indicator, consider it valid
    for (const indicator of jobRoleIndicators) {
        if (indicator.test(roleLower)) {
            return true;
        }
    }
    
    // If it's a longer description that might be a role
    if (roleLower.split(/\s+/).length >= 3) {
        return true;
    }
    
    return false;
}

// =========================================================
// Get Role Suggestions
// =========================================================
function getRoleSuggestions() {
    return [
        "Software Engineer",
        "Frontend Developer",
        "Backend Developer",
        "Full Stack Developer",
        "Data Scientist",
        "Machine Learning Engineer",
        "DevOps Engineer",
        "Cloud Architect",
        "Product Manager",
        "Project Manager",
        "UX Designer",
        "UI Designer",
        "Data Analyst",
        "Business Analyst",
        "System Administrator",
        "Network Engineer",
        "Security Analyst",
        "QA Engineer",
        "Mobile Developer",
        "Web Developer",
        "Database Administrator",
        "Technical Lead",
        "Solution Architect",
        "Scrum Master",
        "Product Owner"
    ];
}

// =========================================================
// Initialize Role Suggestions
// =========================================================
function initializeRoleSuggestions() {
    const chipsContainer = document.getElementById('suggestionChips');
    if (!chipsContainer) return;
    
    const suggestions = getRoleSuggestions().slice(0, 8); // Show 8 suggestions
    
    chipsContainer.innerHTML = '';
    
    suggestions.forEach(role => {
        const chip = document.createElement('div');
        chip.className = 'suggestion-chip';
        chip.textContent = role;
        chip.title = `Click to use: ${role}`;
        
        chip.addEventListener('click', () => {
            roleInput.value = role;
            roleInput.focus();
        });
        
        chipsContainer.appendChild(chip);
    });
}

// =========================================================
// UI Helper Functions
// =========================================================
function appendMessage(sender, message, kind = 'agent') {
    const el = document.createElement('div');
    el.className = 'msg ' + (kind === 'you' ? 'you' : 'agent');
    el.innerHTML = `
        <div class="meta">
            <span class="assistant-name">${sender}</span> 
            <span class="time">${(new Date()).toLocaleTimeString()}</span>
        </div>
        <div class="content">${escapeHtml(message)}</div>
    `;
    chatDiv.appendChild(el);
    chatDiv.scrollTop = chatDiv.scrollHeight;
}

function appendTyping() {
    const el = document.createElement('div');
    el.className = 'msg agent typing-indicator';
    el.id = 'typing-id';
    el.innerHTML = `
        <div class="meta">
            <span class="assistant-name">Interviewer</span> 
            <span class="time">${(new Date()).toLocaleTimeString()}</span>
        </div>
        <div class="typing">
            <div class="dot-anim"></div>
            <div class="dot-anim two"></div>
            <div class="dot-anim three"></div>
        </div>
    `;
    chatDiv.appendChild(el);
    chatDiv.scrollTop = chatDiv.scrollHeight;
}

function removeTyping() {
    const t = document.getElementById('typing-id');
    if (t) t.remove();
}

function appendSystem(text) {
    const el = document.createElement('div');
    el.style.fontSize = '13px';
    el.style.color = '#9fb7c7';
    el.style.textAlign = 'center';
    el.style.margin = '6px 0';
    el.textContent = text;
    chatDiv.appendChild(el);
    chatDiv.scrollTop = chatDiv.scrollHeight;
}

function escapeHtml(unsafe) {
    return unsafe.replace(/[&<"'>]/g, 
        c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[c])
    );
}

// =========================================================
// Start Interview
// =========================================================
startBtn.addEventListener("click", async () => {
    const role = roleInput.value.trim();
    
    // Validate role
    if (!role) {
        await showNeonAlert("Please enter a role to start the interview practice session.", "Role Required");
        roleInput.focus();
        return;
    }
    
    if (!isValidRole(role)) {
        const suggestions = getRoleSuggestions();
        const randomSuggestions = suggestions.sort(() => 0.5 - Math.random()).slice(0, 5);
        
        await showNeonAlert(
            `"${role}" doesn't look like a job role. Please enter a valid job position.<br><br>Try something like:<br>‚Ä¢ ${randomSuggestions.join('<br>‚Ä¢ ')}`,
            "Invalid Role"
        );
        roleInput.focus();
        roleInput.select();
        return;
    }

    startBtn.disabled = true;
    startBtn.textContent = "Starting...";
    statusText.textContent = "Starting...";

    try {
        const res = await fetch("http://127.0.0.1:8000/start", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ role })
        });

        if (!res.ok) throw new Error('Backend start failed: ' + res.status);
        
        const data = await res.json();
        sessionId = data.session_id;

        appendMessage("Interviewer", data.reply, "agent");
        speak(data.reply);
        statusText.textContent = "Active";

    } catch (err) {
        console.error(err);
        appendSystem('Could not start interview. Check backend (http://127.0.0.1:8000).');
        statusText.textContent = "Error";
    } finally {
        startBtn.disabled = false;
        startBtn.textContent = "Start Interview";
    }
});

// Stop Interview button click
document.getElementById("stopBtn").addEventListener("click", async () => {
    const score = Math.floor(Math.random()*41)+60; // Example score
    const feedback = "Good answers! Focus more on explaining your thought process.";

    // Save to sessionStorage
    sessionStorage.setItem("practiceRole", role);
    sessionStorage.setItem("lastScore", score);
    sessionStorage.setItem("lastFeedback", feedback);

    // Show neon alert
    await showNeonAlert(`Your Score: ${score}<br>Feedback: ${feedback}`, "Interview Summary");

    // Redirect to home page
    window.location.href = "home.html";
});
// Initialize score tracking
let correctAnswers = 0;
let totalQuestions = 5;

// When sending a message or receiving an answer, update score
function evaluateAnswer(answer, expected) {
    if(answer.toLowerCase().includes(expected.toLowerCase())) {
        correctAnswers++;
    }
}



// Neon alert function
function showNeonAlert(message, title="Alert") {
    return new Promise(resolve => {
        const overlay = document.createElement("div");
        overlay.className = "neon-alert-overlay";
        overlay.innerHTML = `
            <div class="neon-alert">
                 <div class="neon-alert-icon">‚ö†Ô∏è</div>
                <h3>${title}</h3>
                <p>${message}</p>
                <button id="alertOkBtn">OK</button>
            </div>
        `;
        document.body.appendChild(overlay);

        document.getElementById("alertOkBtn").onclick = () => {
            document.body.removeChild(overlay);
            resolve();
        };
    });
}


// =========================================================
// Send Message (Manual only)
// =========================================================
sendBtn.addEventListener("click", sendMessage);
userInput.addEventListener("keypress", (e) => { 
    if (e.key === "Enter") sendMessage(); 
});

function sendMessage() {
    const text = userInput.value.trim();
    if (!text || !sessionId) {
        if (!text) showNeonAlert("Please enter a message or use the mic to speak", "Message Required");
        return;
    }

    appendMessage("You", text, "you");
    userInput.value = "";

    // Show typing indicator
    appendTyping();
    statusText.textContent = "Thinking...";

    fetch("http://127.0.0.1:8000/message", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ session_id: sessionId, text })
    })
    .then(res => {
        if (!res.ok) throw new Error('Server error: ' + res.status);
        return res.json();
    })
    .then(data => {
        removeTyping();
        appendMessage("Interviewer", data.reply, "agent");
        speak(data.reply);
        statusText.textContent = "Active";
    })
    .catch(err => {
        console.error(err);
        removeTyping();
        appendSystem('Network error while sending message.');
        statusText.textContent = "Error";
    });
}

// =========================================================
// Mic Toggle
// =========================================================
micBtn.addEventListener("click", () => {
    if (!recognition) {
        showNeonAlert("Speech recognition not available", "Microphone Error");
        return;
    }

    stopTTS(); // Stop speaking when mic starts

    if (!isListening) {
        try {
            recognition.start();
        } catch (e) {
            console.error("Error starting recognition:", e);
        }
    } else {
        recognition.stop();
    }
});

// =========================================================
// Browser TTS
// =========================================================
function speak(text) {
    stopTTS();
    const u = new SpeechSynthesisUtterance(text);
    u.lang = "en-US";
    u.rate = 0.95;
    u.pitch = 1;
    
    u.onerror = (event) => {
        console.error("TTS Error:", event);
    };
    
    speechSynthesis.speak(u);
}

// =========================================================
// Initialize with welcome message
// =========================================================
appendSystem('Welcome! Enter a role and click "Start Interview". Use the mic to speak answers.');

// Initialize role suggestions
initializeRoleSuggestions();

// Accessibility: keyboard focus
micBtn.addEventListener('keyup', (e) => { if (e.key === 'Enter') micBtn.click(); });
sendBtn.addEventListener('keyup', (e) => { if (e.key === 'Enter') sendBtn.click(); });
</script>
</body>
</html>
